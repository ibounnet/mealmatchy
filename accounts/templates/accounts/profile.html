{% extends 'base.html' %}
{% block title %}โปรไฟล์ของฉัน{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto">
  <h1 class="text-2xl font-bold text-gray-900 mb-6">โปรไฟล์ของฉัน</h1>

  <div class="bg-white rounded-2xl ring-1 ring-gray-100 p-6 space-y-6">
    <!-- Header: รูป + ชื่อ -->
    <div class="flex items-center gap-4">
      <div class="w-20 h-20 rounded-2xl overflow-hidden bg-gray-100 ring-1 ring-gray-200">
        {% if profile.profile_picture %}
          <img src="{{ profile.profile_picture.url }}" alt="Profile" class="w-full h-full object-cover">
        {% else %}
          <div class="w-full h-full flex items-center justify-center text-gray-400 text-sm">ไม่มีรูป</div>
        {% endif %}
      </div>
      <div>
        <div class="text-lg font-semibold">{{ request.user.get_full_name|default:request.user.username }}</div>
        <div class="text-sm text-gray-500">{{ request.user.email|default:"-" }}</div>
      </div>
    </div>

    <!-- ฟอร์มอัปเดตข้อมูล + รูป (ไม่ซ้อนกับฟอร์มอื่น) -->
    <form method="POST" enctype="multipart/form-data" class="grid grid-cols-1 gap-5">
      {% csrf_token %}
      <input type="hidden" name="action" value="update">

      <div class="grid sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-700 mb-1">ชื่อ</label>
          {{ uform.first_name }}
          {% for e in uform.first_name.errors %}<p class="mt-1 text-sm text-red-600">{{ e }}</p>{% endfor %}
        </div>
        <div>
          <label class="block text-sm text-gray-700 mb-1">นามสกุล</label>
          {{ uform.last_name }}
          {% for e in uform.last_name.errors %}<p class="mt-1 text-sm text-red-600">{{ e }}</p>{% endfor %}
        </div>
      </div>

      <div>
        <label class="block text-sm text-gray-700 mb-1">อีเมล</label>
        {{ uform.email }}
        {% for e in uform.email.errors %}<p class="mt-1 text-sm text-red-600">{{ e }}</p>{% endfor %}
      </div>

      <div>
        <label class="block text-sm text-gray-700 mb-1">แนะนำตัว</label>
        {{ pform.bio }}
        {% for e in pform.bio.errors %}<p class="mt-1 text-sm text-red-600">{{ e }}</p>{% endfor %}
      </div>

      <div>
        <label class="block text-sm text-gray-700 mb-1">รูปโปรไฟล์</label>
        {{ pform.profile_picture }}
        {% for e in pform.profile_picture.errors %}<p class="mt-1 text-sm text-red-600">{{ e }}</p>{% endfor %}
      </div>

      <div class="flex items-center gap-3">
        <button class="px-4 py-2 rounded-xl bg-primary text-white hover:bg-primary-dark transition">
          บันทึกการเปลี่ยนแปลง
        </button>
      </div>
    </form>

    <!-- ฟอร์มลบรูป (แยกฟอร์ม) -->
    <form method="POST" class="inline-block"
          onsubmit="return confirm('ยืนยันลบรูปโปรไฟล์?')">
      {% csrf_token %}
      <input type="hidden" name="action" value="remove_picture">
      <button class="px-4 py-2 rounded-xl ring-1 ring-red-300 text-red-600 hover:bg-red-50">
        ลบรูปโปรไฟล์
      </button>
    </form>

    <!-- ฟอร์มลบโปรไฟล์ (แยกฟอร์ม) -->
    <form method="POST" class="inline-block"
          onsubmit="return confirm('ยืนยันลบโปรไฟล์? จะลบเฉพาะข้อมูลโปรไฟล์ ไม่ลบบัญชีผู้ใช้')">
      {% csrf_token %}
      <input type="hidden" name="action" value="delete_profile">
      <button class="px-4 py-2 rounded-xl ring-1 ring-red-300 text-red-600 hover:bg-red-50">
        ลบโปรไฟล์
      </button>
    </form>
  </div>
</div>
{% endblock %}
