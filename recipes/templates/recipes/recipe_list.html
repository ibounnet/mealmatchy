{% extends "base.html" %}
{% load static %}

{% block title %}รวมสูตรอาหาร{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-8">

  {# ปุ่มบนหัวข้อ #}
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold">รวมสูตรอาหาร</h1>

    <div class="flex gap-3">
      {# ปุ่มสูตรทั้งหมด #}
      <a href="{% url 'recipes:list' %}"
         class="px-4 py-2 rounded-xl text-sm
                {% if not only_mine %}
                  bg-primary text-white hover:bg-primary-dark
                {% else %}
                  bg-white text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50
                {% endif %}">
        สูตรทั้งหมด
      </a>

      {# ปุ่มสูตรของฉัน #}
      <a href="{% url 'recipes:list' %}?mine=1"
         class="px-4 py-2 rounded-xl text-sm
                {% if only_mine %}
                  bg-primary text-white hover:bg-primary-dark
                {% else %}
                  bg-white text-gray-700 ring-1 ring-gray-200 hover:bg-gray-50
                {% endif %}">
        สูตรของฉัน
      </a>

      <a href="{% url 'recipes:add' %}"
         class="px-4 py-2 rounded-xl bg-primary text-white text-sm hover:bg-primary-dark">
        เพิ่มสูตรอาหาร
      </a>
    </div>
  </div>

  {% if recipes %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for r in recipes %}
        <div class="bg-white rounded-2xl shadow-card border border-gray-200 overflow-hidden flex flex-col">

          {# รูปภาพ #}
          <a href="{% url 'recipes:detail' r.id %}">
            {% if r.image %}
              <img src="{{ r.image.url }}" alt="{{ r.title }}"
                   class="w-full h-48 object-cover">
            {% else %}
              <div class="w-full h-48 bg-gray-100 flex items-center justify-center text-gray-400 text-sm">
                ไม่มีรูป
              </div>
            {% endif %}
          </a>

          {# เนื้อหาในการ์ด #}
          <div class="p-4 flex-1 flex flex-col justify-between space-y-2">
            <div class="space-y-1">
              <a href="{% url 'recipes:detail' r.id %}"
                 class="block text-base font-semibold text-gray-900 hover:text-orange-600">
                {{ r.title }}
              </a>

              <p class="text-sm text-gray-600 line-clamp-2">
                {{ r.description|default:"ไม่มีคำอธิบาย" }}
              </p>

              {# เวลาเตรียม / เวลาปรุง #}
              <p class="text-xs text-gray-500">
                เวลาเตรียม {{ r.prep_minutes|default:0 }} นาที ·
                เวลาปรุง {{ r.cook_minutes|default:0 }} นาที ·
                รวม {{ r.prep_minutes|default:0|add:r.cook_minutes|default:0 }} นาที
              </p>
            </div>

            <div class="flex items-center justify-between text-[11px] text-gray-500">
              <div>
                {% if r.created_by %}
                  สร้างโดย: {{ r.created_by.username }}
                {% endif %}
                {% if r.created_at %}
                  • {{ r.created_at|date:"d/m/Y" }}
                {% endif %}
              </div>

              {% if request.user.is_staff or r.created_by_id == request.user.id %}
                <div class="flex gap-3 text-xs">
                  <a href="{% url 'recipes:edit' r.id %}"
                     class="text-orange-600 hover:underline">
                    แก้ไข
                  </a>

                  <form method="post"
                        action="{% url 'recipes:delete' r.id %}"
                        onsubmit="return confirm('ยืนยันลบสูตรอาหารนี้หรือไม่');">
                    {% csrf_token %}
                    <button type="submit"
                            class="text-red-600 hover:underline">
                      ลบ
                    </button>
                  </form>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-gray-500">ยังไม่มีสูตรอาหาร</p>
  {% endif %}
</div>
{% endblock %}
