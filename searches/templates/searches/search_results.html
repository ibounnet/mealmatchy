{% extends "base.html" %}
{% block title %}ผลการค้นหา{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">

  <div class="flex items-start justify-between gap-4 mb-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">ผลการค้นหา</h1>
      <p class="text-sm text-gray-500">
        {% if q %}คำค้น: <span class="font-semibold text-gray-800">{{ q }}</span>{% else %}ยังไม่ได้พิมพ์คำค้น{% endif %}
        <span class="mx-2">•</span>
        ทั้งหมด <span class="font-semibold text-gray-800">{{ total }}</span> รายการ
      </p>
    </div>

    <a href="{% url 'home' %}" class="px-4 py-2 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 text-sm font-semibold">
      กลับหน้าแรก
    </a>
  </div>

  {% if not q %}
    <div class="bg-white rounded-2xl shadow-sm ring-1 ring-gray-200 p-8 text-center text-gray-500">
      พิมพ์คำค้นจากหน้าแรกก่อนนะ
    </div>
  {% else %}

    <!-- MENUS -->
    {% if menus %}
      <section class="bg-white rounded-2xl shadow-sm ring-1 ring-gray-200 p-5 mb-6">
        <div class="flex items-center justify-between gap-3 mb-3">
          <h2 class="text-lg font-bold text-gray-900">เมนูอาหาร</h2>
          <a href="{% url 'menus:menu_list' %}?q={{ q|urlencode }}"
             class="text-sm font-semibold text-primary hover:underline">
            ดูทั้งหมดในหน้าเมนูอาหาร →
          </a>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          {% for m in menus %}
            <!-- ✅ ไม่มีลิงก์ไป detail แล้ว เพื่อกัน NoReverseMatch -->
            <div class="block rounded-2xl ring-1 ring-gray-100 overflow-hidden bg-white hover:shadow-sm transition">
              {% if m.image %}
                <img src="{{ m.image.url }}" alt="{{ m.name }}" class="w-full h-36 object-cover">
              {% else %}
                <div class="w-full h-36 bg-gray-50 flex items-center justify-center text-gray-400 text-sm">ไม่มีรูป</div>
              {% endif %}

              <div class="p-4 space-y-1">
                <div class="font-semibold text-gray-900 line-clamp-1">{{ m.name }}</div>
                <div class="text-xs text-gray-500">
                  ร้าน: {{ m.restaurant_name|default:"-" }}
                </div>
                <div class="text-sm font-bold text-primary-dark">{{ m.price }} บาท</div>

                <div class="pt-2">
                  <a href="{% url 'menus:menu_list' %}?q={{ m.name|urlencode }}"
                     class="inline-flex items-center justify-center w-full px-3 py-2 rounded-xl bg-primary text-white hover:bg-primary-dark text-sm font-semibold">
                    ไปดูในหน้าเมนูอาหาร
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    <!-- RESTAURANTS -->
    {% if restaurants %}
      <section class="bg-white rounded-2xl shadow-sm ring-1 ring-gray-200 p-5 mb-6">
        <h2 class="text-lg font-bold text-gray-900 mb-3">ร้านอาหาร</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for r in restaurants %}
            <div class="rounded-2xl ring-1 ring-gray-100 p-4 bg-white">
              <div class="font-semibold text-gray-900">{{ r.name }}</div>
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    <!-- RECIPES -->
    {% if recipes %}
      <section class="bg-white rounded-2xl shadow-sm ring-1 ring-gray-200 p-5 mb-6">
        <h2 class="text-lg font-bold text-gray-900 mb-3">สูตรอาหาร</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for r in recipes %}
            <a href="{% url 'recipes:detail' r.id %}"
               class="rounded-2xl ring-1 ring-gray-100 p-4 bg-white hover:shadow-sm transition">
              <div class="font-semibold text-gray-900">{{ r.title }}</div>
              {% if r.description %}
                <div class="text-sm text-gray-500 mt-1 line-clamp-2">{{ r.description }}</div>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    <!-- COMMUNITY -->
    {% if topics %}
      <section class="bg-white rounded-2xl shadow-sm ring-1 ring-gray-200 p-5 mb-6">
        <h2 class="text-lg font-bold text-gray-900 mb-3">Community</h2>
        <div class="space-y-3">
          {% for t in topics %}
            <a href="{% url 'community:topic_detail' t.id %}"
               class="block rounded-2xl ring-1 ring-gray-100 p-4 bg-white hover:shadow-sm transition">
              <div class="font-semibold text-gray-900">{{ t.title }}</div>
              {% if t.description %}
                <div class="text-sm text-gray-500 mt-1 line-clamp-2">{{ t.description }}</div>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    {% if total == 0 %}
      <div class="bg-white rounded-2xl shadow-sm ring-1 ring-gray-200 p-8 text-center text-gray-500">
        ไม่พบผลลัพธ์ ลองเปลี่ยนคำค้นดูนะ
      </div>
    {% endif %}

  {% endif %}
</div>
{% endblock %}
